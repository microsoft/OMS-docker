{
"$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
"contentVersion": "1.0.0.0",
"parameters": {
"workspaceResourceId": {
  "type": "string",
  "metadata": {
     "description": "Azure Monitor Log Analytics Resource ID"
   }
},
"workspaceRegion": {
"type": "string",
"metadata": {
   "description": "Azure Monitor Log Analytics workspace region"
  }
 }
},
"resources": [
{
    "type": "Microsoft.Resources/deployments",
    "name": "[Concat('ContainerInsights', '-',  uniqueString(parameters('workspaceResourceId')))]", 
    "apiVersion": "2017-05-10",
    "subscriptionId": "[split(parameters('workspaceResourceId'),'/')[2]]",
    "resourceGroup": "[split(parameters('workspaceResourceId'),'/')[4]]",
    "properties": {
        "mode": "Incremental",
        "template": {
            "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
            "contentVersion": "1.0.0.0",
            "parameters": {},
            "variables": {},
            "resources": [
                   {
                    "apiVersion": "2015-11-01-preview",
                    "type": "Microsoft.OperationsManagement/solutions",
                    "location": "[parameters('workspaceRegion')]",
                    "name": "[Concat('ContainerInsights', '(', split(parameters('workspaceResourceId'),'/')[8], ')')]",
                    "properties": {
                        "workspaceResourceId": "[parameters('workspaceResourceId')]"
                    },
                    "plan": {
                        "name": "[Concat('ContainerInsights', '(', split(parameters('workspaceResourceId'),'/')[8], ')')]",
                        "product": "[Concat('OMSGallery/', 'ContainerInsights')]",
                        "promotionCode": "",
                        "publisher": "Microsoft"
                    }
               }                
            ]
        },
        "parameters": {}
    }
   } 
   ] 
  }
